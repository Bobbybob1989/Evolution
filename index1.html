id: evolution_system_ai
name: Syst√®me d'√âvolution avec IA
type: html
content: |-
  <!DOCTYPE html>
  <html lang="fr">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Syst√®me d'√©volution - IA Enhanced</title>
      <style>
          * { margin: 0; padding: 0; box-sizing: border-box; }
          body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); color: #fff; min-height: 100vh; padding: 10px; }
          .container { max-width: 600px; margin: 0 auto; padding: 20px; }
          .header { text-align: center; margin-bottom: 30px; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 15px; border: 2px solid rgba(255, 215, 0, 0.3); }
          .header h1 { font-size: 24px; margin-bottom: 10px; color: #ffd700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
          .day-counter { font-size: 18px; color: #00d4ff; margin-bottom: 15px; }
          .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
          .stat-card { background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1); }
          .stat-label { font-size: 12px; color: #aaa; margin-bottom: 5px; }
          .stat-value { font-size: 24px; font-weight: bold; }
          .level-bar { background: rgba(0, 0, 0, 0.3); height: 25px; border-radius: 12px; overflow: hidden; margin-bottom: 20px; border: 1px solid rgba(255, 215, 0, 0.3); }
          .level-progress { height: 100%; background: linear-gradient(90deg, #ffd700, #ffed4e); transition: width 0.5s ease; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #000; font-size: 12px; }
          .attributes { margin-bottom: 30px; }
          .attribute { margin-bottom: 15px; }
          .attribute-header { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px; }
          .attribute-bar { background: rgba(0, 0, 0, 0.3); height: 20px; border-radius: 10px; overflow: hidden; border: 1px solid rgba(255, 255, 255, 0.1); }
          .attribute-progress { height: 100%; transition: width 0.5s ease; }
          .force-bar { background: linear-gradient(90deg, #ff4444, #ff6b6b); }
          .intelligence-bar { background: linear-gradient(90deg, #4444ff, #6b6bff); }
          .spirituel-bar { background: linear-gradient(90deg, #44ff44, #6bff6b); }
          .discipline-bar { background: linear-gradient(90deg, #ff44ff, #ff6bff); }
          .quest-card { background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin-bottom: 20px; border: 2px solid rgba(255, 255, 255, 0.1); transition: all 0.3s ease; }
          .quest-card.completed { border-color: #00ff88; background: rgba(0, 255, 136, 0.1); }
          .quest-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
          .quest-title { font-size: 18px; font-weight: bold; display: flex; align-items: center; gap: 10px; }
          .quest-icon { font-size: 24px; }
          .quest-reward { background: rgba(255, 215, 0, 0.2); padding: 5px 10px; border-radius: 5px; font-size: 12px; color: #ffd700; }
          .quest-objectives { margin-bottom: 15px; }
          .objective { display: flex; align-items: center; gap: 10px; padding: 8px; margin-bottom: 5px; background: rgba(0, 0, 0, 0.2); border-radius: 5px; cursor: pointer; transition: all 0.2s ease; }
          .objective:hover { background: rgba(255, 255, 255, 0.1); }
          .objective.completed { opacity: 0.6; text-decoration: line-through; }
          .checkbox { width: 20px; height: 20px; border: 2px solid #fff; border-radius: 5px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
          .checkbox.checked { background: #00ff88; border-color: #00ff88; }
          .checkbox.checked::after { content: '‚úì'; color: #000; font-weight: bold; }
          .complete-quest-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #00d4ff, #0099cc); border: none; border-radius: 10px; color: #fff; font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s ease; }
          .complete-quest-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4); }
          .complete-quest-btn:disabled { background: #555; cursor: not-allowed; transform: none; }
          .complete-quest-btn.completed { background: linear-gradient(135deg, #00ff88, #00cc6a); }
          .perfect-day-banner { background: linear-gradient(135deg, #ffd700, #ffed4e); color: #000; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; font-size: 20px; font-weight: bold; animation: pulse 2s infinite; }
          @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
          .phase-info { background: rgba(0, 212, 255, 0.1); border: 1px solid #00d4ff; border-radius: 10px; padding: 15px; margin-bottom: 20px; font-size: 13px; line-height: 1.6; }
          .phase-info h3 { color: #00d4ff; margin-bottom: 10px; font-size: 16px; }
          .reset-btn { background: rgba(255, 0, 0, 0.2); border: 1px solid #ff4444; color: #ff4444; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 20px; width: 100%; }
          .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); justify-content: center; align-items: center; z-index: 1000; overflow-y: auto; }
          .modal.active { display: flex; }
          .modal-content { background: #16213e; padding: 30px; border-radius: 15px; border: 2px solid #ffd700; max-width: 500px; max-height: 90vh; overflow-y: auto; text-align: center; margin: 20px; }
          .modal-title { font-size: 24px; color: #ffd700; margin-bottom: 15px; }
          .modal-text { margin-bottom: 20px; line-height: 1.6; }
          .modal-buttons { display: flex; gap: 10px; }
          .modal-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; font-weight: bold; }
          .modal-btn-confirm { background: #00ff88; color: #000; }
          .modal-btn-cancel { background: #ff4444; color: #fff; }
          .title-display { font-size: 14px; color: #ffd700; font-style: italic; }
          .phase-indicator { background: rgba(0, 212, 255, 0.2); border: 1px solid #00d4ff; padding: 8px 15px; border-radius: 20px; display: inline-block; margin-bottom: 10px; font-size: 12px; color: #00d4ff; }
          .time-remaining { font-size: 14px; color: #ff6b35; margin-top: 10px; }
          .history-btn { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: #ffd700; color: #000; border: none; font-size: 24px; cursor: pointer; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4); transition: all 0.3s; z-index: 100; }
          .history-btn:hover { transform: scale(1.1); }
          .history-day { background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin-bottom: 20px; border: 2px solid rgba(255, 215, 0, 0.3); text-align: left; }
          .history-day h3 { color: #ffd700; margin-bottom: 15px; }
          .history-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
          .history-stat { background: rgba(255, 255, 255, 0.08); border-radius: 10px; padding: 10px; text-align: center; }
          .history-stat-value { font-size: 20px; font-weight: bold; color: #00d4ff; }
          .history-stat-label { font-size: 11px; color: #aaa; margin-top: 5px; }
          .quest-summary { margin-top: 10px; font-size: 13px; color: #aaa; }
          .activity-badge { padding: 5px 10px; border-radius: 5px; font-size: 11px; display: inline-block; margin-top: 10px; margin-right: 5px; }
          .running-badge { background: rgba(255, 100, 50, 0.3); border: 1px solid #ff6432; color: #ff6432; }
          .pullup-badge { background: rgba(100, 150, 255, 0.3); border: 1px solid #6496ff; color: #6496ff; }
          .circuit-badge { background: rgba(255, 215, 0, 0.3); border: 1px solid #ffd700; color: #ffd700; }
          .ai-badge { background: rgba(138, 43, 226, 0.3); border: 1px solid #8a2be2; color: #8a2be2; }
          .change-workout-btn { width: 100%; padding: 10px; background: rgba(255, 165, 0, 0.2); border: 1px solid #ffa500; color: #ffa500; border-radius: 8px; font-size: 14px; cursor: pointer; margin-bottom: 15px; transition: all 0.3s; }
          .change-workout-btn:hover { background: rgba(255, 165, 0, 0.3); transform: translateY(-1px); }
          .ai-workout-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #8a2be2, #9b59b6); border: none; border-radius: 10px; color: #fff; font-size: 16px; font-weight: bold; cursor: pointer; margin-bottom: 15px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; }
          .ai-workout-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(138, 43, 226, 0.4); }
          .ai-workout-btn:disabled { background: #555; cursor: wait; }
          .ai-workout-btn .spinner { display: none; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; }
          .ai-workout-btn.loading .spinner { display: inline-block; }
          @keyframes spin { to { transform: rotate(360deg); } }
          .workout-options { display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 15px; }
          .workout-option { padding: 15px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(255, 255, 255, 0.1); border-radius: 10px; cursor: pointer; transition: all 0.3s; text-align: left; }
          .workout-option:hover { border-color: #00d4ff; background: rgba(0, 212, 255, 0.1); }
          .workout-option.selected { border-color: #00ff88; background: rgba(0, 255, 136, 0.1); }
          .workout-option-title { font-weight: bold; color: #00d4ff; margin-bottom: 5px; }
          .workout-option-desc { font-size: 12px; color: #aaa; }
          .timer-btn { position: fixed; bottom: 20px; left: 20px; width: 60px; height: 60px; border-radius: 50%; background: #00d4ff; color: #000; border: none; font-size: 24px; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 212, 255, 0.4); transition: all 0.3s; z-index: 100; }
          .timer-btn:hover { transform: scale(1.1); }
          .api-key-input { width: 100%; padding: 10px; background: rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.2); color: #fff; border-radius: 8px; margin-bottom: 15px; font-size: 14px; }
          .api-key-input::placeholder { color: #888; }
          .api-status { padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 13px; }
          .api-status.success { background: rgba(0, 255, 136, 0.2); border: 1px solid #00ff88; color: #00ff88; }
          .api-status.error { background: rgba(255, 68, 68, 0.2); border: 1px solid #ff4444; color: #ff4444; }
          .ai-advice { background: rgba(138, 43, 226, 0.1); border: 1px solid #8a2be2; border-radius: 10px; padding: 15px; margin-bottom: 15px; font-size: 13px; line-height: 1.6; }
          .ai-advice-title { color: #8a2be2; font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
          .settings-btn { position: fixed; top: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: rgba(255, 255, 255, 0.1); color: #fff; border: 1px solid rgba(255, 255, 255, 0.2); font-size: 20px; cursor: pointer; transition: all 0.3s; z-index: 100; }
          .settings-btn:hover { background: rgba(255, 255, 255, 0.2); transform: rotate(90deg); }
      </style>
  </head>
  <body>
      <div class="container">
          <div class="header">
              <div class="phase-indicator" id="phaseIndicator">Phase 1 : Fondations</div>
              <h1>üéØ Syst√®me d'√©volution</h1>
              <div class="title-display" id="titleDisplay">L'Aspirant</div>
              <div class="day-counter">Jour <span id="currentDay">1</span>/84</div>
              <div class="time-remaining" id="timeRemaining"></div>
          </div>

          <div class="stats-grid">
              <div class="stat-card"><div class="stat-label">Niveau</div><div class="stat-value" id="level">1</div></div>
              <div class="stat-card"><div class="stat-label">XP</div><div class="stat-value"><span id="currentXP">0</span>/<span id="maxXP">100</span></div></div>
              <div class="stat-card"><div class="stat-label">S√©rie üî•</div><div class="stat-value" id="streak">0</div></div>
              <div class="stat-card"><div class="stat-label">Jetons üíé</div><div class="stat-value" id="tokens">0</div></div>
          </div>

          <div class="level-bar"><div class="level-progress" id="levelProgress" style="width: 0%"><span id="levelProgressText">0%</span></div></div>

          <div class="attributes">
              <div class="attribute"><div class="attribute-header"><span>üí™ Force</span><span><span id="forceValue">10</span> pts</span></div><div class="attribute-bar"><div class="attribute-progress force-bar" id="forceBar" style="width: 3.5%"></div></div></div>
              <div class="attribute"><div class="attribute-header"><span>üß† Intelligence</span><span><span id="intelligenceValue">10</span> pts</span></div><div class="attribute-bar"><div class="attribute-progress intelligence-bar" id="intelligenceBar" style="width: 3.5%"></div></div></div>
              <div class="attribute"><div class="attribute-header"><span>üßò Spirituel</span><span><span id="spirituelValue">10</span> pts</span></div><div class="attribute-bar"><div class="attribute-progress spirituel-bar" id="spirituelBar" style="width: 3.5%"></div></div></div>
              <div class="attribute"><div class="attribute-header"><span>‚ö° Discipline</span><span><span id="disciplineValue">10</span> pts</span></div><div class="attribute-bar"><div class="attribute-progress discipline-bar" id="disciplineBar" style="width: 3.5%"></div></div></div>
          </div>

          <div id="perfectDayBanner" style="display: none;" class="perfect-day-banner">üéâ JOURN√âE PARFAITE ! üéâ<br>Tous les objectifs compl√©t√©s !</div>

          <div class="phase-info" id="phaseInfo"><h3>üìã Programme du jour</h3><div id="phaseDescription"></div></div>

          <div class="quest-card" id="questForce">
              <div class="quest-header"><div class="quest-title"><span class="quest-icon">üí™</span><span>Force</span></div><div class="quest-reward">+2 PTS +10 XP</div></div>
              <div id="forceBadges"></div>
              
              <button class="ai-workout-btn" onclick="generateAIWorkout()">
                  <span class="spinner"></span>
                  <span>ü§ñ G√©n√©rer entra√Ænement IA personnalis√©</span>
              </button>
              
              <div id="aiAdvice" style="display: none;"></div>
              
              <button class="change-workout-btn" onclick="showWorkoutOptions()">üîÑ Changer d'entra√Ænement</button>
              <div class="quest-objectives" id="forceObjectives"></div>
              <button class="complete-quest-btn" onclick="completeQuest('force')">‚úÖ Valider</button>
          </div>

          <div class="quest-card" id="questIntelligence">
              <div class="quest-header"><div class="quest-title"><span class="quest-icon">üß†</span><span>Intelligence</span></div><div class="quest-reward">+2 PTS +10 XP</div></div>
              <div class="quest-objectives" id="intelligenceObjectives"></div>
              <button class="complete-quest-btn" onclick="completeQuest('intelligence')">‚úÖ Valider</button>
          </div>

          <div class="quest-card" id="questSpirituel">
              <div class="quest-header"><div class="quest-title"><span class="quest-icon">üßò</span><span>Spirituel</span></div><div class="quest-reward">+2 PTS +10 XP</div></div>
              <div class="quest-objectives" id="spirituelObjectives"></div>
              <button class="complete-quest-btn" onclick="completeQuest('spirituel')">‚úÖ Valider</button>
          </div>

          <div class="quest-card" id="questDiscipline">
              <div class="quest-header"><div class="quest-title"><span class="quest-icon">‚ö°</span><span>Discipline</span></div><div class="quest-reward">+2 PTS +10 XP</div></div>
              <div class="quest-objectives" id="disciplineObjectives"></div>
              <button class="complete-quest-btn" onclick="completeQuest('discipline')">‚úÖ Valider</button>
          </div>

          <button class="reset-btn" onclick="showResetModal()">R√©initialiser le Syst√®me</button>
      </div>

      <button class="settings-btn" onclick="showSettings()">‚öôÔ∏è</button>
      <button class="timer-btn" onclick="showTimer()">‚è±Ô∏è</button>
      <button class="history-btn" onclick="showHistory()">üìä</button>

      <!-- Modal Param√®tres API -->
      <div class="modal" id="settingsModal">
          <div class="modal-content">
              <div class="modal-title">‚öôÔ∏è Param√®tres IA</div>
              <div class="modal-text" style="text-align: left;">
                  <p style="margin-bottom: 15px;">Pour utiliser la g√©n√©ration d'entra√Ænements par IA, configure ta cl√© API Gemini (gratuite) :</p>
                  <ol style="margin-bottom: 15px; padding-left: 20px; line-height: 1.8;">
                      <li>Va sur <a href="https://makersuite.google.com/app/apikey" target="_blank" style="color: #00d4ff;">Google AI Studio</a></li>
                      <li>Cr√©e une cl√© API gratuite</li>
                      <li>Colle-la ci-dessous</li>
                  </ol>
              </div>
              <input type="text" id="apiKeyInput" class="api-key-input" placeholder="Colle ta cl√© API Gemini ici...">
              <div id="apiStatus" class="api-status" style="display: none;"></div>
              <div class="modal-buttons">
                  <button class="modal-btn modal-btn-cancel" onclick="closeSettings()">Annuler</button>
                  <button class="modal-btn modal-btn-confirm" onclick="saveApiKey()">Enregistrer</button>
              </div>
          </div>
      </div>

      <!-- Modal Workout Options -->
      <div class="modal" id="workoutModal">
          <div class="modal-content">
              <div class="modal-title">üèãÔ∏è Choisir ton entra√Ænement</div>
              <div class="modal-text">S√©lectionne l'entra√Ænement que tu peux faire aujourd'hui :</div>
              <div class="workout-options" id="workoutOptions"></div>
              <div class="modal-buttons">
                  <button class="modal-btn modal-btn-cancel" onclick="closeWorkoutModal()">Annuler</button>
                  <button class="modal-btn modal-btn-confirm" onclick="confirmWorkoutChange()">Confirmer</button>
              </div>
          </div>
      </div>

      <!-- Modal History -->
      <div class="modal" id="historyModal">
          <div class="modal-content">
              <div class="modal-title">üìä Historique de ton √©volution</div>
              <div id="historyContent"></div>
              <button class="modal-btn modal-btn-confirm" onclick="closeHistory()" style="width: 100%; margin-top: 20px;">Fermer</button>
          </div>
      </div>

      <!-- Modal Timer -->
      <div class="modal" id="timerModal">
          <div class="modal-content" style="max-width: 600px;">
              <div class="modal-title">‚è±Ô∏è Chronom√©tre d'Entra√Ænement</div>
              <div class="modal-text">Fonctionnalit√© √† venir...</div>
              <button class="modal-btn modal-btn-confirm" onclick="closeTimer()" style="width: 100%;">Fermer</button>
          </div>
      </div>

      <!-- Modal Reset -->
      <div class="modal" id="resetModal">
          <div class="modal-content">
              <div class="modal-title">‚ö†Ô∏è R√©initialisation</div>
              <div class="modal-text">Es-tu s√ªr de vouloir r√©initialiser tout ton progr√®s ?<br>Cette action est irr√©versible.</div>
              <div class="modal-buttons">
                  <button class="modal-btn modal-btn-cancel" onclick="closeResetModal()">Annuler</button>
                  <button class="modal-btn modal-btn-confirm" onclick="confirmReset()">Confirmer</button>
              </div>
          </div>
      </div>

      <!-- Modal Level Up -->
      <div class="modal" id="levelUpModal">
          <div class="modal-content">
              <div class="modal-title">üéâ LEVEL UP ! üéâ</div>
              <div class="modal-text" id="levelUpText"></div>
              <button class="modal-btn modal-btn-confirm" onclick="closeLevelUpModal()" style="width: 100%;">Continuer</button>
          </div>
      </div>

      <script>
          const LEVELS = [
              {xp:0,title:"L'Aspirant",bonus:""},
              {xp:100,title:"Le Disciple",bonus:"+5% XP"},
              {xp:250,title:"L'Apprenti D√©termin√©",bonus:"Carte R√©cup bonus"},
              {xp:450,title:"Le Pratiquant Assidu",bonus:"Objectifs bonus"},
              {xp:700,title:"L'Adepte Disciplin√©",bonus:"+10% XP"},
              {xp:1000,title:"Le Guerrier de l'Habitude",bonus:"-2 min exercices"},
              {xp:1350,title:"Le Ma√Ætre en Devenir",bonus:"+15% XP"},
              {xp:1750,title:"Le Champion Personnel",bonus:"Mode √©lite"},
              {xp:2200,title:"L'Architecte de Soi",bonus:"Objectifs perso"},
              {xp:2700,title:"Le Souverain √âveill√©",bonus:"Ma√Ætrise totale"}
          ];
          
          const PROGRAMMES = {
              phase1: {
                  name:"Phase 1 : Fondations",
                  desc:"√âtablir les bases solides - 15 min par objectif",
                  forceCircuits: [
                      {name:"Circuit Classique",type:"circuit",exercises:[{t:"10 Pompes (genoux ok)",c:"0/10"},{t:"15 Squats",c:"0/15"},{t:"20 sec Planche",c:"0/20s"},{t:"10 Fentes par jambe",c:"0/20"},{t:"15 Abdos crunch",c:"0/15"},{t:"R√©p√©ter 3 circuits",c:"0/3"}]},
                      {name:"Circuit Dynamique",type:"circuit",exercises:[{t:"12 Pompes inclin√©es",c:"0/12"},{t:"20 Squats avec pause",c:"0/20"},{t:"15 sec Planche x2",c:"0/2"},{t:"12 Fentes arri√®re/jambe",c:"0/24"},{t:"20 Relev√©s de jambes",c:"0/20"},{t:"R√©p√©ter 3 circuits",c:"0/3"}]},
                      {name:"Circuit Endurance",type:"circuit",exercises:[{t:"8 Pompes lentes",c:"0/8"},{t:"25 Squats rapides",c:"0/25"},{t:"30 sec Planche genou-coude",c:"0/30s"},{t:"15 Fentes lat√©rales/jambe",c:"0/30"},{t:"20 Abdos bicyclette",c:"0/20"},{t:"R√©p√©ter 3 circuits",c:"0/3"}]}
                  ],
                  forceRunning:{name:"Running 5km",type:"running",exercises:[{t:"üèÉ Running 5km minimum",c:"0/5km"},{t:"√âchauffement 5 min",c:"‚úì"},{t:"√âtirements 5 min",c:"‚úì"}]},
                  forcePullUps:{name:"Tractions D√©butant",type:"pullups",exercises:[{t:"5 Tractions n√©gatives",c:"0/5"},{t:"10 Tractions australiennes",c:"0/10"},{t:"20 sec Suspension barre",c:"0/20s"},{t:"10 Pompes",c:"0/10"},{t:"15 Rowing invers√©",c:"0/15"},{t:"R√©p√©ter 3 circuits",c:"0/3"}]},
                  intelligence:[{t:"10 min : 1 le√ßon Duolingo (d√©butant)",c:"‚úì"},{t:"5 min : 1 Sudoku facile",c:"‚úì"}],
                  spirituel:[{t:"5 min coh√©rence cardiaque",c:"0/5min"},{t:"8 min m√©ditation guid√©e",c:"0/8min"},{t:"2 min gratitude (3 choses)",c:"0/2min"}],
                  discipline:[{t:"Faire son lit au r√©veil",c:"‚úì"},{t:"Boire 1 verre d'eau",c:"‚úì"},{t:"Noter 3 priorit√©s du jour",c:"‚úì"},{t:"Identifier t√¢che difficile",c:"‚úì"},{t:"Visualiser journ√©e (2 min)",c:"‚úì"},{t:"Revue du soir",c:"‚úì"},{t:"Pr√©parer v√™tements demain",c:"‚úì"}]
              },
              phase2: {
                  name:"Phase 2 : Progression",
                  desc:"Augmenter l'intensit√© - 20 min par objectif",
                  forceCircuits:[
                      {name:"Circuit Force",type:"circuit",exercises:[{t:"15 Pompes standard",c:"0/15"},{t:"20 Squats saut√©s",c:"0/20"},{t:"30 sec Planche",c:"0/30s"},{t:"15 Fentes saut√©es/jambe",c:"0/30"},{t:"20 Abdos bicyclette",c:"0/20"},{t:"10 Burpees",c:"0/10"},{t:"R√©p√©ter 3 circuits",c:"0/3"}]},
                      {name:"Circuit Explosivit√©",type:"circuit",exercises:[{t:"12 Pompes claqu√©es",c:"0/12"},{t:"15 Squats jump + maintien",c:"0/15"},{t:"25 sec Planche lat√©rale x2",c:"0/2"},{t:"20 Fentes bulgares/jambe",c:"0/40"},{t:"15 Mountain climbers",c:"0/30s"},{t:"12 Burpees",c:"0/12"},{t:"R√©p√©ter 3 circuits",c:"0/3"}]},
                      {name:"Circuit R√©sistance",type:"circuit",exercises:[{t:"20 Pompes tempo",c:"0/20"},{t:"30 Squats avec pause",c:"0/30"},{t:"40 sec Planche lev√©e jambe",c:"0/40s"},{t:"15 Fentes march√©es/jambe",c:"0/30"},{t:"25 Crunchs invers√©s",c:"0/25"},{t:"15 Burpees",c:"0/15"},{t:"R√©p√©ter 3 circuits",c:"0/3"}]}
                  ],
                  forceRunning:{name:"Running 5km",type:"running",exercises:[{t:"üèÉ Running 5km minimum",c:"0/5km"},{t:"√âchauffement 5 min",c:"‚úì"},{t:"√âtirements 5 min",c:"‚úì"}]},
                  forcePullUps:{name:"Tractions Interm√©diaire",type:"pullups",exercises:[{t:"3-5 Tractions compl√®tes",c:"0/5"},{t:"8 Tractions n√©gatives",c:"0/8"},{t:"12 Tractions australiennes",c:"0/12"},{t:"30 sec Suspension active",c:"0/30s"},{t:"15 Pompes",c:"0/15"},{t:"R√©p√©ter 4 circuits",c:"0/4"}]},
                  intelligence:[{t:"10 min : 1 le√ßon Duolingo (interm√©diaire)",c:"‚úì"},{t:"5 min : 1 Sudoku moyen",c:"‚úì"}],
                  spirituel:[{t:"5 min coh√©rence cardiaque",c:"0/5min"},{t:"10 min m√©ditation non-guid√©e",c:"0/10min"},{t:"3 min journaling √©motionnel",c:"0/3min"},{t:"2 min gratitude approfondie",c:"0/2min"}],
                  discipline:[{t:"Routine matinale < 10 min",c:"‚úì"},{t:"Pas de t√©l√©phone 30 min",c:"‚úì"},{t:"Manger la grenouille en 1er",c:"‚úì"},{t:"3 blocs focus sans distraction",c:"0/3"},{t:"Dire non √† 1 distraction",c:"‚úì"},{t:"Revue du soir d√©taill√©e",c:"‚úì"},{t:"Pr√©parer demain (10 min)",c:"‚úì"}]
              },
              phase3: {
                  name:"Phase 3 : Ma√Ætrise",
                  desc:"Atteindre l'excellence - 25 min par objectif",
                  forceCircuits:[
                      {name:"Circuit Puissance",type:"circuit",exercises:[{t:"20 Pompes diamant",c:"0/20"},{t:"25 Squats pistol",c:"0/25"},{t:"45 sec Planche",c:"0/45s"},{t:"20 Fentes bulgares/jambe",c:"0/40"},{t:"25 Abdos V-ups",c:"0/25"},{t:"15 Burpees",c:"0/15"},{t:"30 sec Mountain climbers",c:"0/30s"},{t:"R√©p√©ter 3 circuits",c:"0/3"}]},
                      {name:"Circuit Technique",type:"circuit",exercises:[{t:"15 Pompes archer x2",c:"0/30"},{t:"20 Squats saut√©s + rotation",c:"0/20"},{t:"30 sec Planche + lat√©rale",c:"0/2"},{t:"25 Fentes saut√©es altern√©es",c:"0/25"},{t:"20 Abdos complets",c:"0/20"},{t:"20 Burpees avec pompe",c:"0/20"},{t:"40 sec Mountain climbers",c:"0/40s"},{t:"R√©p√©ter 3 circuits",c:"0/3"}]},
                      {name:"Circuit Intensit√©",type:"circuit",exercises:[{t:"25 Pompes d√©clin√©es",c:"0/25"},{t:"30 Squats jump",c:"0/30"},{t:"60 sec Planche RKC",c:"0/60s"},{t:"15 Fentes bulgares saut√©es/jambe",c:"0/30"},{t:"30 Hollow body hold",c:"0/30s"},{t:"25 Burpees",c:"0/25"},{t:"30 sec Sprint sur place",c:"0/30s"},{t:"R√©p√©ter 3 circuits",c:"0/3"}]}
                  ],
                  forceRunning:{name:"Running 5km",type:"running",exercises:[{t:"üèÉ Running 5km minimum",c:"0/5km"},{t:"√âchauffement 5 min",c:"‚úì"},{t:"√âtirements 5 min",c:"‚úì"}]},
                  forcePullUps:{name:"Tractions Avanc√©",type:"pullups",exercises:[{t:"8-10 Tractions compl√®tes",c:"0/10"},{t:"5 Tractions lentes",c:"0/5"},{t:"3 Tractions L-sit",c:"0/3"},{t:"45 sec Suspension",c:"0/45s"},{t:"20 Pompes d√©clin√©es",c:"0/20"},{t:"R√©p√©ter 4 circuits",c:"0/4"}]},
                  intelligence:[{t:"10 min : 1 le√ßon Duolingo (avanc√©)",c:"‚úì"},{t:"5 min : 1 Sudoku difficile",c:"‚úì"}],
                  spirituel:[{t:"7 min coh√©rence cardiaque",c:"0/7min"},{t:"15 min m√©ditation profonde",c:"0/15min"},{t:"5 min journaling introspectif",c:"0/5min"},{t:"3 min visualisation objectifs",c:"0/3min"}],
                  discipline:[{t:"Routine matinale optimis√©e",c:"‚úì"},{t:"Pas de t√©l√©phone 1h",c:"‚úì"},{t:"Grenouille + t√¢che bonus",c:"‚úì"},{t:"4 blocs focus Pomodoro",c:"0/4"},{t:"Dire non √† 2 distractions",c:"0/2"},{t:"Revue hebdomadaire (si dim.)",c:"‚úì"},{t:"Planification semaine",c:"‚úì"},{t:"Pr√©parer demain (15 min)",c:"‚úì"}]
              }
          };

          let gameState = {
              level:1,
              xp:0,
              currentDay:1,
              streak:0,
              tokens:0,
              attributes:{force:10,intelligence:10,spirituel:10,discipline:10},
              quests:{force:false,intelligence:false,spirituel:false,discipline:false},
              objectivesChecked:{},
              startDate:null,
              lastCompletedDate:null,
              history:[],
              currentForceWorkout:null,
              selectedWorkoutTemp:null,
              apiKey:null,
              aiWorkouts:[],
              lastAIAdvice:null
          };

          function getTodayLocal(){
              const now=new Date();
              return `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;
          }
          
          function saveGameState(){
              localStorage.setItem('evolutionSystem',JSON.stringify(gameState));
          }
          
          function loadGameState(){
              const saved=localStorage.getItem('evolutionSystem');
              if(saved){
                  gameState=JSON.parse(saved);
              }else{
                  gameState.startDate=getTodayLocal();
              }
              checkNewDay();
          }
          
          function checkNewDay(){
              const today=getTodayLocal();
              if(gameState.startDate!==today){
                  const questsCompleted=Object.values(gameState.quests).filter(q=>q===true).length;
                  const isPerfectDay=questsCompleted===4;
                  gameState.history.push({
                      day:gameState.currentDay,
                      date:gameState.startDate,
                      quests:{...gameState.quests},
                      questsCompleted:questsCompleted,
                      isPerfectDay:isPerfectDay,
                      level:gameState.level,
                      xp:gameState.xp,
                      attributes:{...gameState.attributes},
                      workoutType:gameState.currentForceWorkout
                  });
                  if(questsCompleted>=3){
                      gameState.streak++;
                  }else{
                      gameState.streak=0;
                  }
                  gameState.currentDay++;
                  gameState.startDate=today;
                  gameState.quests={force:false,intelligence:false,spirituel:false,discipline:false};
                  gameState.objectivesChecked={};
                  gameState.lastCompletedDate=null;
                  gameState.currentForceWorkout=null;
                  gameState.lastAIAdvice=null;
                  saveGameState();
              }
          }
          
          function getCurrentPhase(){
              if(gameState.currentDay<=28)return 'phase1';
              if(gameState.currentDay<=56)return 'phase2';
              return 'phase3';
          }
          
          function isRunningDay(){
              return[2,4,6].includes(new Date().getDay());
          }
          
          function isPullUpDay(){
              return[1,4].includes(new Date().getDay());
          }
          
          function getDefaultForceWorkout(){
              const phase=getCurrentPhase();
              const programme=PROGRAMMES[phase];
              if(isRunningDay()){
                  return programme.forceRunning;
              }else if(isPullUpDay()){
                  return programme.forcePullUps;
              }else{
                  return programme.forceCircuits[(gameState.currentDay-1)%3];
              }
          }
          
          function getCurrentForceWorkout(){
              if(gameState.currentForceWorkout){
                  const phase=getCurrentPhase();
                  const programme=PROGRAMMES[phase];
                  if(gameState.currentForceWorkout==='running'){
                      return programme.forceRunning;
                  }else if(gameState.currentForceWorkout==='pullups'){
                      return programme.forcePullUps;
                  }else if(gameState.currentForceWorkout.startsWith('circuit')){
                      return programme.forceCircuits[parseInt(gameState.currentForceWorkout.replace('circuit',''))];
                  }else if(gameState.currentForceWorkout==='ai'){
                      // Retourner le dernier workout IA g√©n√©r√©
                      const lastAI = gameState.aiWorkouts[gameState.aiWorkouts.length - 1];
                      if(lastAI) return lastAI;
                  }
              }
              return getDefaultForceWorkout();
          }
          
          function showWorkoutOptions(){
              const phase=getCurrentPhase();
              const programme=PROGRAMMES[phase];
              const optionsContainer=document.getElementById('workoutOptions');
              optionsContainer.innerHTML='';
              
              const runningDiv=document.createElement('div');
              runningDiv.className='workout-option';
              runningDiv.onclick=()=>selectWorkout('running');
              runningDiv.innerHTML=`<div class="workout-option-title">üèÉ ${programme.forceRunning.name}</div><div class="workout-option-desc">Course √† pied 5km minimum</div>`;
              optionsContainer.appendChild(runningDiv);
              
              const pullUpsDiv=document.createElement('div');
              pullUpsDiv.className='workout-option';
              pullUpsDiv.onclick=()=>selectWorkout('pullups');
              pullUpsDiv.innerHTML=`<div class="workout-option-title">üí™ ${programme.forcePullUps.name}</div><div class="workout-option-desc">D√©veloppement du dos et bras</div>`;
              optionsContainer.appendChild(pullUpsDiv);
              
              programme.forceCircuits.forEach((circuit,index)=>{
                  const circuitDiv=document.createElement('div');
                  circuitDiv.className='workout-option';
                  circuitDiv.onclick=()=>selectWorkout('circuit'+index);
                  circuitDiv.innerHTML=`<div class="workout-option-title">üèãÔ∏è ${circuit.name}</div><div class="workout-option-desc">Circuit au poids du corps</div>`;
                  optionsContainer.appendChild(circuitDiv);
              });
              
              document.getElementById('workoutModal').classList.add('active');
          }
          
          function selectWorkout(type){
              document.querySelectorAll('.workout-option').forEach(el=>el.classList.remove('selected'));
              event.currentTarget.classList.add('selected');
              gameState.selectedWorkoutTemp=type;
          }
          
          function confirmWorkoutChange(){
              if(gameState.selectedWorkoutTemp){
                  gameState.currentForceWorkout=gameState.selectedWorkoutTemp;
                  gameState.objectivesChecked={};
                  saveGameState();
                  updateUI();
                  closeWorkoutModal();
              }else{
                  alert('S√©lectionne un entra√Ænement !');
              }
          }
          
          function closeWorkoutModal(){
              document.getElementById('workoutModal').classList.remove('active');
              gameState.selectedWorkoutTemp=null;
          }

          // ============ FONCTIONS IA ============
          
          function showSettings(){
              document.getElementById('settingsModal').classList.add('active');
              if(gameState.apiKey){
                  document.getElementById('apiKeyInput').value = gameState.apiKey;
                  showApiStatus('Cl√© API enregistr√©e ‚úì', 'success');
              }
          }
          
          function closeSettings(){
              document.getElementById('settingsModal').classList.remove('active');
          }
          
          function saveApiKey(){
              const apiKey = document.getElementById('apiKeyInput').value.trim();
              if(!apiKey){
                  showApiStatus('Veuillez entrer une cl√© API', 'error');
                  return;
              }
              gameState.apiKey = apiKey;
              saveGameState();
              showApiStatus('Cl√© API enregistr√©e avec succ√®s ! üéâ', 'success');
              setTimeout(closeSettings, 2000);
          }
          
          function showApiStatus(message, type){
              const status = document.getElementById('apiStatus');
              status.textContent = message;
              status.className = `api-status ${type}`;
              status.style.display = 'block';
          }
          
          async function generateAIWorkout(){
              if(!gameState.apiKey){
                  alert('‚ö†Ô∏è Configure d\'abord ta cl√© API Gemini dans les param√®tres (‚öôÔ∏è)');
                  showSettings();
                  return;
              }
              
              const btn = document.querySelector('.ai-workout-btn');
              btn.classList.add('loading');
              btn.disabled = true;
              
              try {
                  const phase = getCurrentPhase();
                  const recentHistory = gameState.history.slice(-7);
                  
                  const prompt = `Tu es un coach sportif expert. G√©n√®re un entra√Ænement personnalis√© au poids du corps.

PROFIL DE L'ATHL√àTE :
- Niveau actuel : ${gameState.level} (${LEVELS[gameState.level-1].title})
- Jour d'entra√Ænement : ${gameState.currentDay}/84
- Phase : ${PROGRAMMES[phase].name}
- Force : ${gameState.attributes.force} pts
- S√©rie actuelle : ${gameState.streak} jours
- Historique 7 derniers jours : ${recentHistory.length} jours compl√©t√©s

CONTRAINTES :
- Dur√©e : 15-20 minutes maximum
- Mat√©riel : Aucun (poids du corps uniquement)
- Lieu : Maison ou ext√©rieur
- Niveau : ${phase === 'phase1' ? 'D√©butant √† interm√©diaire' : phase === 'phase2' ? 'Interm√©diaire' : 'Avanc√©'}

G√âN√àRE UN CIRCUIT avec :
1. 5-7 exercices vari√©s (haut du corps, bas du corps, core, cardio)
2. Nombre de r√©p√©titions ou dur√©e pour chaque exercice
3. Nombre de circuits √† r√©p√©ter (3-4)
4. Un conseil motivationnel personnalis√© bas√© sur sa progression

FORMAT DE R√âPONSE (JSON strict) :
{
  "name": "Nom du circuit",
  "exercises": [
    {"t": "Description exercice", "c": "0/reps ou 0/dur√©e"},
    ...
  ],
  "advice": "Conseil motivationnel personnalis√© (2-3 phrases)"
}

IMPORTANT : R√©ponds UNIQUEMENT avec le JSON, sans texte avant ou apr√®s.`;

                  const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${gameState.apiKey}`, {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify({
                          contents: [{
                              parts: [{ text: prompt }]
                          }]
                      })
                  });
                  
                  if(!response.ok){
                      throw new Error('Erreur API Gemini');
                  }
                  
                  const data = await response.json();
                  const aiText = data.candidates[0].content.parts[0].text;
                  
                  // Nettoyer le texte pour extraire le JSON
                  let jsonText = aiText.trim();
                  if(jsonText.startsWith('```json')){
                      jsonText = jsonText.replace(/```json\n?/g, '').replace(/```\n?/g, '');
                  }
                  if(jsonText.startsWith('```')){
                      jsonText = jsonText.replace(/```\n?/g, '');
                  }
                  
                  const aiWorkout = JSON.parse(jsonText);
                  
                  // Cr√©er le workout au bon format
                  const newWorkout = {
                      name: aiWorkout.name || "Circuit IA Personnalis√©",
                      type: "ai",
                      exercises: aiWorkout.exercises || []
                  };
                  
                  // Sauvegarder le workout et le conseil
                  gameState.aiWorkouts.push(newWorkout);
                  gameState.lastAIAdvice = aiWorkout.advice || "Donne tout aujourd'hui ! üí™";
                  gameState.currentForceWorkout = 'ai';
                  gameState.objectivesChecked = {};
                  saveGameState();
                  
                  // Afficher le conseil IA
                  displayAIAdvice(gameState.lastAIAdvice);
                  
                  updateUI();
                  
              } catch(error) {
                  console.error('Erreur g√©n√©ration IA:', error);
                  alert('‚ùå Erreur lors de la g√©n√©ration. V√©rifie ta cl√© API dans les param√®tres.');
              } finally {
                  btn.classList.remove('loading');
                  btn.disabled = false;
              }
          }
          
          function displayAIAdvice(advice){
              const container = document.getElementById('aiAdvice');
              container.innerHTML = `
                  <div class="ai-advice">
                      <div class="ai-advice-title">ü§ñ Conseil de ton Coach IA</div>
                      <div>${advice}</div>
                  </div>
              `;
              container.style.display = 'block';
          }
          
          // ============ FIN FONCTIONS IA ============
          
          function updateUI(){
              document.getElementById('currentDay').textContent=gameState.currentDay;
              document.getElementById('level').textContent=gameState.level;
              document.getElementById('currentXP').textContent=gameState.xp;
              document.getElementById('streak').textContent=gameState.streak;
              document.getElementById('tokens').textContent=gameState.tokens;
              
              const currentLevel=LEVELS[gameState.level-1];
              const nextLevel=LEVELS[gameState.level]||LEVELS[LEVELS.length-1];
              const maxXP=nextLevel.xp-currentLevel.xp;
              const currentXPInLevel=gameState.xp-currentLevel.xp;
              const progress=Math.min((currentXPInLevel/maxXP)*100,100);
              
              document.getElementById('maxXP').textContent=maxXP;
              document.getElementById('levelProgress').style.width=progress+'%';
              document.getElementById('levelProgressText').textContent=Math.round(progress)+'%';
              document.getElementById('titleDisplay').textContent=currentLevel.title;
              
              ['force','intelligence','spirituel','discipline'].forEach(attr=>{
                  const value=gameState.attributes[attr];
                  document.getElementById(attr+'Value').textContent=value;
                  const barProgress=Math.min((value/280)*100,100);
                  document.getElementById(attr+'Bar').style.width=barProgress+'%';
              });
              
              const phase=getCurrentPhase();
              const programme=PROGRAMMES[phase];
              document.getElementById('phaseIndicator').textContent=programme.name;
              document.getElementById('phaseDescription').textContent=programme.desc;
              
              // Afficher le conseil IA si disponible
              if(gameState.lastAIAdvice && gameState.currentForceWorkout === 'ai'){
                  displayAIAdvice(gameState.lastAIAdvice);
              } else {
                  document.getElementById('aiAdvice').style.display = 'none';
              }
              
              const forceWorkout=getCurrentForceWorkout();
              const forceObjectives=forceWorkout.exercises;
              const container=document.getElementById('forceObjectives');
              container.innerHTML='';
              
              forceObjectives.forEach((obj,index)=>{
                  const isChecked=gameState.objectivesChecked['force_'+index];
                  const div=document.createElement('div');
                  div.className='objective'+(isChecked?' completed':'');
                  div.onclick=()=>toggleObjective('force',index);
                  div.innerHTML=`<div class="checkbox${isChecked?' checked':''}"></div><span>${obj.t}</span>`;
                  container.appendChild(div);
              });
              
              const badgesContainer=document.getElementById('forceBadges');
              badgesContainer.innerHTML='';
              
              if(forceWorkout.type==='running'){
                  badgesContainer.innerHTML='<span class="activity-badge running-badge">üèÉ Jour de running : 5km minimum</span>';
              }else if(forceWorkout.type==='pullups'){
                  badgesContainer.innerHTML='<span class="activity-badge pullup-badge">üí™ Jour Tractions : D√©veloppe ton dos !</span>';
              }else if(forceWorkout.type==='ai'){
                  badgesContainer.innerHTML='<span class="activity-badge ai-badge">ü§ñ Circuit IA Personnalis√©</span>';
              }else{
                  badgesContainer.innerHTML=`<span class="activity-badge circuit-badge">üèãÔ∏è ${forceWorkout.name}</span>`;
              }
              
              ['intelligence','spirituel','discipline'].forEach(questType=>{
                  const objectives=programme[questType];
                  const container=document.getElementById(questType+'Objectives');
                  container.innerHTML='';
                  objectives.forEach((obj,index)=>{
                      const isChecked=gameState.objectivesChecked[questType+'_'+index];
                      const div=document.createElement('div');
                      div.className='objective'+(isChecked?' completed':'');
                      div.onclick=()=>toggleObjective(questType,index);
                      div.innerHTML=`<div class="checkbox${isChecked?' checked':''}"></div><span>${obj.t}</span>`;
                      container.appendChild(div);
                  });
              });
              
              ['force','intelligence','spirituel','discipline'].forEach(questType=>{
                  const questCard=document.getElementById('quest'+questType.charAt(0).toUpperCase()+questType.slice(1));
                  const btn=questCard.querySelector('.complete-quest-btn');
                  if(gameState.quests[questType]){
                      questCard.classList.add('completed');
                      btn.textContent='‚úÖ Compl√©t√©';
                      btn.classList.add('completed');
                      btn.disabled=true;
                  }else{
                      questCard.classList.remove('completed');
                      btn.textContent='‚úÖ Valider';
                      btn.classList.remove('completed');
                      btn.disabled=false;
                  }
              });
              
              const allCompleted=Object.values(gameState.quests).every(q=>q===true);
              document.getElementById('perfectDayBanner').style.display=allCompleted?'block':'none';
          }
          
          function toggleObjective(questType,index){
              checkNewDay();
              const key=questType+'_'+index;
              gameState.objectivesChecked[key]=!gameState.objectivesChecked[key];
              saveGameState();
              updateUI();
          }
          
          function completeQuest(questType){
              checkNewDay();
              if(gameState.quests[questType]){
                  alert('Cet objectif est d√©j√† compl√©t√© aujourd\'hui !');
                  return;
              }
              
              const today=getTodayLocal();
              if(gameState.lastCompletedDate===today){
                  const completedCount=Object.values(gameState.quests).filter(q=>q===true).length;
                  if(completedCount>=4){
                      alert('Tu as d√©j√† valid√© tous tes objectifs aujourd\'hui !');
                      return;
                  }
              }
              
              gameState.quests[questType]=true;
              gameState.lastCompletedDate=today;
              gameState.attributes[questType]+=2;
              gameState.xp+=10;
              
              const allCompleted=Object.values(gameState.quests).every(q=>q===true);
              if(allCompleted&&gameState.lastCompletedDate===today){
                  gameState.xp+=10;
                  gameState.tokens+=1;
              }
              
              checkLevelUp();
              saveGameState();
              updateUI();
          }
          
          function checkLevelUp(){
              const nextLevel=LEVELS[gameState.level];
              if(nextLevel&&gameState.xp>=nextLevel.xp){
                  gameState.level++;
                  showLevelUpModal();
              }
          }
          
          function showLevelUpModal(){
              const level=LEVELS[gameState.level-1];
              document.getElementById('levelUpText').innerHTML=`<p style="font-size: 48px; margin: 20px 0;">üéâ</p><p style="font-size: 24px; margin-bottom: 10px;">Niveau ${gameState.level}</p><p style="font-size: 18px; color: #ffd700; margin-bottom: 20px;">${level.title}</p><p style="font-size: 14px; color: #aaa;">${level.bonus}</p>`;
              document.getElementById('levelUpModal').classList.add('active');
          }
          
          function closeLevelUpModal(){
              document.getElementById('levelUpModal').classList.remove('active');
          }
          
          function updateTimeRemaining(){
              const now
=new Date();
              const tomorrow=new Date(now);
              tomorrow.setDate(tomorrow.getDate()+1);
              tomorrow.setHours(0,0,0,0);
              const diff=tomorrow-now;
              const hours=Math.floor(diff/(1000*60*60));
              const minutes=Math.floor((diff%(1000*60*60))/(1000*60));
              document.getElementById('timeRemaining').textContent=`‚è∞ ${hours}h ${minutes}min avant minuit`;
          }
          
          function showHistory(){
              checkNewDay();
              const content=document.getElementById('historyContent');
              if(gameState.history.length===0){
                  content.innerHTML='<p style="color: #aaa; padding: 20px;">Aucun historique pour le moment.<br>Compl√®te ta premi√®re journ√©e !</p>';
              }else{
                  content.innerHTML=gameState.history.slice().reverse().map(day=>{
                      let workoutBadge='';
                      if(day.workoutType==='running')workoutBadge='üèÉ Running';
                      else if(day.workoutType==='pullups')workoutBadge='üí™ Tractions';
                      else if(day.workoutType==='ai')workoutBadge='ü§ñ IA Personnalis√©';
                      else if(day.workoutType&&day.workoutType.startsWith('circuit'))workoutBadge='üèãÔ∏è Circuit';
                      
                      return `<div class="history-day">
                          <h3>Jour ${day.day} - ${new Date(day.date).toLocaleDateString('fr-FR')}</h3>
                          <div class="quest-summary">
                              ${day.quests.force?'‚úÖ':'‚ùå'} Force | 
                              ${day.quests.intelligence?'‚úÖ':'‚ùå'} Intelligence | 
                              ${day.quests.spirituel?'‚úÖ':'‚ùå'} Spirituel | 
                              ${day.quests.discipline?'‚úÖ':'‚ùå'} Discipline
                              ${day.isPerfectDay?'<br><strong style="color: #ffd700;">üéâ JOURN√âE PARFAITE</strong>':''}
                              ${workoutBadge?'<br><span style="color: #00d4ff;">'+workoutBadge+'</span>':''}
                          </div>
                          <div class="history-stats">
                              <div class="history-stat">
                                  <div class="history-stat-value">${day.questsCompleted}/4</div>
                                  <div class="history-stat-label">Objectifs</div>
                              </div>
                              <div class="history-stat">
                                  <div class="history-stat-value">Niv. ${day.level}</div>
                                  <div class="history-stat-label">Niveau</div>
                              </div>
                              <div class="history-stat">
                                  <div class="history-stat-value">${day.xp}</div>
                                  <div class="history-stat-label">XP Total</div>
                              </div>
                              <div class="history-stat">
                                  <div class="history-stat-value">${day.attributes.force}</div>
                                  <div class="history-stat-label">Force</div>
                              </div>
                          </div>
                      </div>`;
                  }).join('');
              }
              document.getElementById('historyModal').classList.add('active');
          }
          
          function closeHistory(){
              document.getElementById('historyModal').classList.remove('active');
          }
          
          function showTimer(){
              document.getElementById('timerModal').classList.add('active');
          }
          
          function closeTimer(){
              document.getElementById('timerModal').classList.remove('active');
          }
          
          function showResetModal(){
              document.getElementById('resetModal').classList.add('active');
          }
          
          function closeResetModal(){
              document.getElementById('resetModal').classList.remove('active');
          }
          
          function confirmReset(){
              if(confirm('‚ö†Ô∏è DERNI√àRE CONFIRMATION : Tout sera perdu !')){
                  localStorage.removeItem('evolutionSystem');
                  location.reload();
              }
          }

          // Initialisation
          setInterval(function(){
              checkNewDay();
              updateUI();
              updateTimeRemaining();
          },60000);
          
          window.onload=function(){
              loadGameState();
              updateUI();
              updateTimeRemaining();
              setInterval(updateTimeRemaining,10000);
          };
      </script>
  </body>
  </html>
