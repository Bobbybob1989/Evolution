<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solo Leveling - Syst√®me d'√âvolution</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%); 
            color: #fff; 
            min-height: 100vh; 
            padding: 10px; 
            position: relative;
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(138, 43, 226, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; position: relative; z-index: 1; padding-bottom: 220px; }
        
        .header { 
            text-align: center; 
            margin-bottom: 30px; 
            padding: 25px; 
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.2)); 
            border-radius: 20px; 
            border: 2px solid rgba(138, 43, 226, 0.5);
            box-shadow: 0 8px 32px rgba(138, 43, 226, 0.3);
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '‚ö°';
            position: absolute;
            font-size: 200px;
            opacity: 0.05;
            top: -50px;
            right: -50px;
            animation: pulse 3s infinite;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.05; } 50% { transform: scale(1.1); opacity: 0.08; } }
        
        .header h1 { 
            font-size: 28px; 
            margin-bottom: 10px; 
            background: linear-gradient(90deg, #8a2be2, #da70d6, #8a2be2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 900;
            letter-spacing: 2px;
        }
        .subtitle { font-size: 13px; color: #aaa; font-style: italic; margin-bottom: 15px; }
        .day-counter { 
            font-size: 20px; 
            color: #da70d6; 
            margin-bottom: 10px; 
            font-weight: bold;
            text-shadow: 0 0 10px rgba(218, 112, 214, 0.5);
        }
        .title-display { 
            font-size: 16px; 
            color: #ffd700; 
            font-style: italic; 
            margin-top: 10px;
            padding: 8px 15px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 20px;
            display: inline-block;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .health-status {
            background: rgba(255, 68, 68, 0.1);
            border: 2px solid #ff4444;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        .health-status.active { display: block; animation: healthAlert 2s infinite; }
        @keyframes healthAlert { 0%, 100% { border-color: #ff4444; } 50% { border-color: #ff8888; } }
        .health-status-title { color: #ff4444; font-weight: bold; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .health-status-text { font-size: 13px; color: #ffaaaa; line-height: 1.6; }
        .health-btn { 
            width: 100%; 
            padding: 12px; 
            background: rgba(255, 68, 68, 0.2); 
            border: 1px solid #ff4444; 
            color: #ff4444; 
            border-radius: 10px; 
            cursor: pointer; 
            margin-bottom: 20px; 
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .health-btn:hover { background: rgba(255, 68, 68, 0.3); transform: translateY(-2px); }
        
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px; }
        .stat-card { 
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.1)); 
            padding: 18px; 
            border-radius: 15px; 
            border: 1px solid rgba(138, 43, 226, 0.3);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(138, 43, 226, 0.2), transparent);
            transition: left 0.5s;
        }
        .stat-card:hover::before { left: 100%; }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 5px 20px rgba(138, 43, 226, 0.4); }
        .stat-label { font-size: 12px; color: #aaa; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { font-size: 26px; font-weight: bold; color: #da70d6; text-shadow: 0 0 10px rgba(218, 112, 214, 0.5); }
        
        .level-bar { 
            background: rgba(0, 0, 0, 0.5); 
            height: 30px; 
            border-radius: 15px; 
            overflow: hidden; 
            margin-bottom: 25px; 
            border: 2px solid rgba(138, 43, 226, 0.5);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.5);
        }
        .level-progress { 
            height: 100%; 
            background: linear-gradient(90deg, #8a2be2, #da70d6, #8a2be2); 
            transition: width 0.5s ease; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: bold; 
            color: #fff; 
            font-size: 13px;
            text-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
            position: relative;
            overflow: hidden;
        }
        .level-progress::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer { 0% { left: -100%; } 100% { left: 100%; } }
        
        .attributes { margin-bottom: 30px; }
        .attribute { margin-bottom: 18px; }
        .attribute-header { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 8px; 
            font-size: 15px;
            font-weight: 600;
        }
        .attribute-bar { 
            background: rgba(0, 0, 0, 0.5); 
            height: 24px; 
            border-radius: 12px; 
            overflow: hidden; 
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
        }
        .attribute-progress { height: 100%; transition: width 0.5s ease; position: relative; }
        .attribute-progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.2), transparent);
        }
        .force-bar { background: linear-gradient(90deg, #ff4444, #ff6b6b, #ff4444); }
        .intelligence-bar { background: linear-gradient(90deg, #4444ff, #6b6bff, #4444ff); }
        .spirituel-bar { background: linear-gradient(90deg, #44ff44, #6bff6b, #44ff44); }
        .discipline-bar { background: linear-gradient(90deg, #ff44ff, #ff6bff, #ff44ff); }
        
        .quest-card { 
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.05)); 
            border-radius: 20px; 
            padding: 25px; 
            margin-bottom: 25px; 
            border: 2px solid rgba(138, 43, 226, 0.3); 
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .quest-card::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, transparent, rgba(138, 43, 226, 0.5), transparent);
            border-radius: 20px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: -1;
        }
        .quest-card:hover::before { opacity: 1; }
        .quest-card:hover { transform: translateY(-5px); box-shadow: 0 10px 40px rgba(138, 43, 226, 0.4); }
        .quest-card.completed { 
            border-color: #00ff88; 
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 200, 100, 0.05));
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }
        .quest-card.adapted {
            border-color: #ffa500;
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.15), rgba(255, 140, 0, 0.05));
        }
        
        .quest-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .quest-title { font-size: 20px; font-weight: bold; display: flex; align-items: center; gap: 12px; }
        .quest-icon { font-size: 28px; filter: drop-shadow(0 0 10px currentColor); }
        .quest-reward { 
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.2)); 
            padding: 8px 15px; 
            border-radius: 20px; 
            font-size: 12px; 
            color: #ffd700;
            border: 1px solid rgba(255, 215, 0, 0.5);
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .quest-objectives { margin-bottom: 20px; }
        .objective { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            padding: 12px; 
            margin-bottom: 8px; 
            background: rgba(0, 0, 0, 0.3); 
            border-radius: 10px; 
            cursor: pointer; 
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        .objective:hover { 
            background: rgba(138, 43, 226, 0.2); 
            transform: translateX(5px);
            border-color: rgba(138, 43, 226, 0.5);
        }
        .objective.completed { 
            opacity: 0.6; 
            text-decoration: line-through; 
            background: rgba(0, 255, 136, 0.1);
        }
        .checkbox { 
            width: 24px; 
            height: 24px; 
            border: 2px solid #8a2be2; 
            border-radius: 8px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .checkbox.checked { 
            background: linear-gradient(135deg, #00ff88, #00cc6a); 
            border-color: #00ff88;
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
        }
        .checkbox.checked::after { content: '‚úì'; color: #000; font-weight: bold; font-size: 16px; }
        
        .complete-quest-btn { 
            width: 100%; 
            padding: 15px; 
            background: linear-gradient(135deg, #8a2be2, #9b59b6); 
            border: none; 
            border-radius: 12px; 
            color: #fff; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.4);
        }
        .complete-quest-btn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 8px 30px rgba(138, 43, 226, 0.6);
        }
        .complete-quest-btn:disabled { 
            background: #555; 
            cursor: not-allowed; 
            transform: none;
            box-shadow: none;
        }
        .complete-quest-btn.completed { 
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
        }
        
        .generate-daily-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #da70d6, #8a2be2);
            border: none;
            border-radius: 15px;
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 25px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 8px 30px rgba(138, 43, 226, 0.5);
            position: relative;
            overflow: hidden;
        }
        .generate-daily-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .generate-daily-btn:hover::before { width: 300px; height: 300px; }
        .generate-daily-btn:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 12px 40px rgba(138, 43, 226, 0.7);
        }
        .generate-daily-btn:disabled { 
            background: #555; 
            cursor: wait;
            box-shadow: none;
        }
        .generate-daily-btn .spinner { 
            display: none; 
            width: 24px; 
            height: 24px; 
            border: 3px solid rgba(255,255,255,0.3); 
            border-top-color: #fff; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
        }
        .generate-daily-btn.loading .spinner { display: inline-block; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .perfect-day-banner { 
            background: linear-gradient(135deg, #ffd700, #ffed4e); 
            color: #000; 
            padding: 25px; 
            border-radius: 20px; 
            text-align: center; 
            margin-bottom: 25px; 
            font-size: 22px; 
            font-weight: bold; 
            animation: perfectPulse 2s infinite;
            box-shadow: 0 10px 40px rgba(255, 215, 0, 0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        @keyframes perfectPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
        
        .phase-info { 
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.15), rgba(75, 0, 130, 0.1)); 
            border: 2px solid rgba(138, 43, 226, 0.5); 
            border-radius: 15px; 
            padding: 20px; 
            margin-bottom: 25px; 
            font-size: 14px; 
            line-height: 1.8;
        }
        .phase-info h3 { 
            color: #da70d6; 
            margin-bottom: 12px; 
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-advice { 
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.1)); 
            border: 2px solid #8a2be2; 
            border-radius: 15px; 
            padding: 20px; 
            margin-bottom: 20px; 
            font-size: 14px; 
            line-height: 1.8;
            position: relative;
            overflow: hidden;
        }
        .ai-advice::before {
            content: 'ü§ñ';
            position: absolute;
            font-size: 100px;
            opacity: 0.05;
            right: -20px;
            bottom: -20px;
        }
        .ai-advice-title { 
            color: #da70d6; 
            font-weight: bold; 
            margin-bottom: 12px; 
            display: flex; 
            align-items: center; 
            gap: 10px;
            font-size: 16px;
        }
        
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.9); 
            justify-content: center; 
            align-items: center; 
            z-index: 1000; 
            overflow-y: auto;
            backdrop-filter: blur(10px);
        }
        .modal.active { display: flex; }
        .modal-content { 
            background: linear-gradient(135deg, #16213e, #1a1a2e); 
            padding: 35px; 
            border-radius: 25px; 
            border: 3px solid #8a2be2; 
            max-width: 500px; 
            max-height: 90vh; 
            overflow-y: auto; 
            text-align: center; 
            margin: 20px;
            box-shadow: 0 20px 60px rgba(138, 43, 226, 0.5);
        }
        .modal-title { 
            font-size: 26px; 
            color: #da70d6; 
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(218, 112, 214, 0.5);
        }
        .modal-text { margin-bottom: 25px; line-height: 1.8; font-size: 15px; }
        .modal-buttons { display: flex; gap: 12px; }
        .modal-btn { 
            flex: 1; 
            padding: 15px; 
            border: none; 
            border-radius: 12px; 
            font-size: 16px; 
            cursor: pointer; 
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .modal-btn:hover { transform: translateY(-3px); }
        .modal-btn-confirm { 
            background: linear-gradient(135deg, #00ff88, #00cc6a); 
            color: #000;
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
        }
        .modal-btn-cancel { 
            background: linear-gradient(135deg, #ff4444, #cc0000); 
            color: #fff;
            box-shadow: 0 5px 20px rgba(255, 68, 68, 0.4);
        }
        
        .settings-btn, .history-btn, .health-report-btn { 
            position: fixed; 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            color: #fff; 
            border: 2px solid rgba(138, 43, 226, 0.5); 
            font-size: 24px; 
            cursor: pointer; 
            transition: all 0.3s; 
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 20px rgba(138, 43, 226, 0.4);
            pointer-events: auto;
        }
        .settings-btn { 
            top: 20px; 
            right: 20px; 
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.8), rgba(75, 0, 130, 0.8));
        }
        .history-btn { 
            bottom: 20px; 
            right: 20px; 
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.8), rgba(255, 165, 0, 0.8));
        }
        .health-report-btn {
            bottom: 90px;
            right: 20px;
            background: linear-gradient(135deg, rgba(255, 68, 68, 0.8), rgba(200, 0, 0, 0.8));
        }
        .settings-btn:hover, .history-btn:hover, .health-report-btn:hover { 
            transform: scale(1.15) rotate(90deg); 
            box-shadow: 0 8px 30px rgba(138, 43, 226, 0.6);
        }
        
        .injury-form { text-align: left; }
        .form-group { margin-bottom: 20px; }
        .form-label { 
            display: block; 
            margin-bottom: 8px; 
            color: #da70d6; 
            font-weight: bold;
            font-size: 14px;
        }
        .form-input, .form-select, .form-textarea { 
            width: 100%; 
            padding: 12px; 
            background: rgba(0, 0, 0, 0.4); 
            border: 2px solid rgba(138, 43, 226, 0.3); 
            color: #fff; 
            border-radius: 10px; 
            font-size: 14px;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #8a2be2;
            box-shadow: 0 0 20px rgba(138, 43, 226, 0.3);
        }
        .form-textarea { min-height: 100px; resize: vertical; font-family: inherit; }
        .form-input::placeholder, .form-textarea::placeholder { color: #666; }
        
        .time-remaining { 
            font-size: 14px; 
            color: #ff6b35; 
            margin-top: 12px;
            padding: 8px 15px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 20px;
            display: inline-block;
            border: 1px solid rgba(255, 107, 53, 0.3);
        }
        
        .history-day { 
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.05)); 
            border-radius: 20px; 
            padding: 25px; 
            margin-bottom: 20px; 
            border: 2px solid rgba(138, 43, 226, 0.3); 
            text-align: left;
        }
        .history-day h3 { color: #da70d6; margin-bottom: 15px; font-size: 18px; }
        .history-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 15px; }
        .history-stat { 
            background: rgba(138, 43, 226, 0.1); 
            border-radius: 12px; 
            padding: 12px; 
            text-align: center;
            border: 1px solid rgba(138, 43, 226, 0.2);
        }
        .history-stat-value { font-size: 22px; font-weight: bold; color: #da70d6; }
        .history-stat-label { font-size: 11px; color: #aaa; margin-top: 5px; text-transform: uppercase; }
        .quest-summary { margin-top: 12px; font-size: 14px; color: #aaa; line-height: 1.6; }
        
        .api-key-input { 
            width: 100%; 
            padding: 12px; 
            background: rgba(0, 0, 0, 0.4); 
            border: 2px solid rgba(138, 43, 226, 0.3); 
            color: #fff; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            font-size: 14px;
        }
        .api-key-input::placeholder { color: #666; }
        .api-status { 
            padding: 12px; 
            border-radius: 10px; 
            margin-bottom: 15px; 
            font-size: 13px;
            font-weight: bold;
        }
        .api-status.success { 
            background: rgba(0, 255, 136, 0.2); 
            border: 2px solid #00ff88; 
            color: #00ff88; 
        }
        .api-status.error { 
            background: rgba(255, 68, 68, 0.2); 
            border: 2px solid #ff4444; 
            color: #ff4444; 
        }
        
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { 
            background: linear-gradient(180deg, #8a2be2, #da70d6); 
            border-radius: 10px; 
        }
        ::-webkit-scrollbar-thumb:hover { background: linear-gradient(180deg, #9b59b6, #e0a0e0); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° SOLO LEVELING SYSTEM ‚ö°</h1>
            <div class="subtitle">Syst√®me d'√âvolution Holistique</div>
            <div class="title-display" id="titleDisplay">L'Aspirant</div>
            <div class="day-counter">Jour <span id="currentDay">1</span>/84</div>
            <div class="time-remaining" id="timeRemaining"></div>
        </div>

        <div class="health-status" id="healthStatus">
            <div class="health-status-title">‚ö†Ô∏è Mode R√©cup√©ration Actif</div>
            <div class="health-status-text" id="healthStatusText"></div>
        </div>

        <button class="health-btn" onclick="showHealthReport()">üè• Signaler une blessure/maladie</button>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Niveau</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">XP</div>
                <div class="stat-value"><span id="currentXP">0</span>/<span id="maxXP">100</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">S√©rie üî•</div>
                <div class="stat-value" id="streak">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Jetons üíé</div>
                <div class="stat-value" id="tokens">0</div>
            </div>
        </div>

        <div class="level-bar">
            <div class="level-progress" id="levelProgress" style="width: 0%">
                <span id="levelProgressText">0%</span>
            </div>
        </div>

        <div class="attributes">
            <div class="attribute">
                <div class="attribute-header">
                    <span>üí™ Force</span>
                    <span><span id="forceValue">10</span> pts</span>
                </div>
                <div class="attribute-bar">
                    <div class="attribute-progress force-bar" id="forceBar" style="width: 3.5%"></div>
                </div>
            </div>
            <div class="attribute">
                <div class="attribute-header">
                    <span>üß† Intelligence</span>
                    <span><span id="intelligenceValue">10</span> pts</span>
                </div>
                <div class="attribute-bar">
                    <div class="attribute-progress intelligence-bar" id="intelligenceBar" style="width: 3.5%"></div>
                </div>
            </div>
            <div class="attribute">
                <div class="attribute-header">
                    <span>üßò Spirituel</span>
                    <span><span id="spirituelValue">10</span> pts</span>
                </div>
                <div class="attribute-bar">
                    <div class="attribute-progress spirituel-bar" id="spirituelBar" style="width: 3.5%"></div>
                </div>
            </div>
            <div class="attribute">
                <div class="attribute-header">
                    <span>‚ö° Discipline</span>
                    <span><span id="disciplineValue">10</span> pts</span>
                </div>
                <div class="attribute-bar">
                    <div class="attribute-progress discipline-bar" id="disciplineBar" style="width: 3.5%"></div>
                </div>
            </div>
        </div>

        <div id="perfectDayBanner" style="display: none;" class="perfect-day-banner">
            üéâ JOURN√âE PARFAITE ! üéâ<br>Tous les objectifs compl√©t√©s !
        </div>

        <button class="generate-daily-btn" onclick="generateDailyProgram()">
            <span class="spinner"></span>
            <span>ü§ñ G√©n√©rer Programme Quotidien</span>
        </button>

        <div id="aiAdvice" style="display: none;"></div>

        <div class="phase-info" id="phaseInfo">
            <h3>üìã Programme du jour</h3>
            <div id="phaseDescription">Clique sur "G√©n√©rer Programme Quotidien" pour recevoir tes qu√™tes personnalis√©es !</div>
        </div>

        <div id="questsContainer"></div>
    </div>

    <button class="settings-btn" onclick="showSettings()">‚öôÔ∏è</button>
    <button class="history-btn" onclick="showHistory()">üìä</button>
    <button class="health-report-btn" onclick="showHealthReport()">üè•</button>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-title">‚öôÔ∏è Configuration IA</div>
            <div class="modal-text" style="text-align: left;">
                <p style="margin-bottom: 15px;">Pour utiliser le syst√®me Solo Leveling, configure ta cl√© API Gemini (gratuite) :</p>
                <ol style="margin-bottom: 15px; padding-left: 20px; line-height: 1.8;">
                    <li>Va sur <a href="https://makersuite.google.com/app/apikey" target="_blank" style="color: #da70d6;">Google AI Studio</a></li>
                    <li>Cr√©e une cl√© API gratuite</li>
                    <li>Colle-la ci-dessous</li>
                </ol>
            </div>
            <input type="text" id="apiKeyInput" class="api-key-input" placeholder="Colle ta cl√© API Gemini ici...">
            <div id="apiStatus" class="api-status" style="display: none;"></div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="closeSettings()">Annuler</button>
                <button class="modal-btn modal-btn-confirm" onclick="saveApiKey()">Enregistrer</button>
            </div>
        </div>
    </div>

    <div class="modal" id="healthModal">
        <div class="modal-content">
            <div class="modal-title">üè• Signaler un probl√®me de sant√©</div>
            <div class="modal-text" style="text-align: left; margin-bottom: 20px;">
                L'IA adaptera automatiquement ton programme pour favoriser ta r√©cup√©ration.
            </div>
            <div class="injury-form">
                <div class="form-group">
                    <label class="form-label">Type de probl√®me</label>
                    <select id="healthType" class="form-select">
                        <option value="">-- S√©lectionne --</option>
                        <option value="injury">Blessure physique</option>
                        <option value="illness">Maladie</option>
                        <option value="fatigue">Fatigue extr√™me</option>
                        <option value="mental">Sant√© mentale</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Zone affect√©e / Description</label>
                    <input type="text" id="healthLocation" class="form-input" placeholder="Ex: Genou droit, Grippe, √âpuisement...">
                </div>
                <div class="form-group">
                    <label class="form-label">Gravit√© (1-10)</label>
                    <input type="number" id="healthSeverity" class="form-input" min="1" max="10" value="5">
                </div>
                <div class="form-group">
                    <label class="form-label">D√©tails suppl√©mentaires</label>
                    <textarea id="healthDetails" class="form-textarea" placeholder="D√©cris tes sympt√¥mes, limitations, recommandations m√©dicales..."></textarea>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" onclick="closeHealthReport()">Annuler</button>
                <button class="modal-btn modal-btn-confirm" onclick="submitHealthReport()">Adapter Programme</button>
            </div>
            <button class="modal-btn modal-btn-cancel" onclick="clearHealthStatus()" style="width: 100%; margin-top: 10px;">
                Gu√©rison compl√®te - Retour normal
            </button>
        </div>
    </div>

    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-title">üìä Historique d'√âvolution</div>
            <div id="historyContent"></div>
            <button class="modal-btn modal-btn-confirm" onclick="closeHistory()" style="width: 100%; margin-top: 20px;">Fermer</button>
        </div>
    </div>

    <div class="modal" id="levelUpModal">
        <div class="modal-content">
            <div class="modal-title">üéâ LEVEL UP ! üéâ</div>
            <div class="modal-text" id="levelUpText"></div>
            <button class="modal-btn modal-btn-confirm" onclick="closeLevelUpModal()" style="width: 100%;">Continuer</button>
        </div>
    </div>

    <script>
        // üîç CONSOLE DE D√âBOGAGE INT√âGR√âE
        const debugLog = document.createElement('div');
        debugLog.style.cssText = 'position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,0.95);color:#0f0;padding:10px;font-size:10px;max-height:200px;overflow-y:auto;z-index:9999;font-family:monospace;border-top:2px solid #0f0;';
        document.body.appendChild(debugLog);

        function log(msg, isError = false) {
            const time = new Date().toLocaleTimeString();
            const color = isError ? '#f00' : '#0f0';
            debugLog.innerHTML += `<div style="color:${color};margin:2px 0;">[${time}] ${msg}</div>`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(msg);
        }

        window.addEventListener('error', (e) => {
            log(`‚ùå ERREUR GLOBALE: ${e.message} (${e.filename}:${e.lineno})`, true);
        });

        log('‚úÖ Console de d√©bogage initialis√©e');

        const LEVELS = [
            {xp:0,title:"L'Aspirant",bonus:"D√©but de l'aventure"},
            {xp:100,title:"Le Disciple",bonus:"+5% XP"},
            {xp:250,title:"L'Apprenti D√©termin√©",bonus:"R√©cup√©ration am√©lior√©e"},
            {xp:450,title:"Le Pratiquant Assidu",bonus:"Objectifs bonus"},
            {xp:700,title:"L'Adepte Disciplin√©",bonus:"+10% XP"},
            {xp:1000,title:"Le Guerrier de l'Habitude",bonus:"Efficacit√© +15%"},
            {xp:1350,title:"Le Ma√Ætre en Devenir",bonus:"+15% XP"},
            {xp:1750,title:"Le Champion Personnel",bonus:"Mode √©lite d√©bloqu√©"},
            {xp:2200,title:"L'Architecte de Soi",bonus:"Objectifs personnalis√©s"},
            {xp:2700,title:"Le Souverain √âveill√©",bonus:"Ma√Ætrise totale"}
        ];

        let gameState = {
            level:1,
            xp:0,
            currentDay:1,
            streak:0,
            tokens:0,
            attributes:{force:10,intelligence:10,spirituel:10,discipline:10},
            quests:{},
            objectivesChecked:{},
            dailyProgram:null,
            lastGeneratedDate:null,
            lastCompletedDate:null,
            history:[],
            apiKey:null,
            healthStatus:null,
            lastAIAdvice:null
        };

        function getTodayLocal(){
            const now=new Date();
            return `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,'0')}-${String(now.getDate()).padStart(2,'0')}`;
        }

        function saveGameState(){
            localStorage.setItem('soloLevelingState',JSON.stringify(gameState));
            log('üíæ √âtat sauvegard√©');
        }

        function loadGameState(){
            const saved=localStorage.getItem('soloLevelingState');
            if(saved){
                gameState=JSON.parse(saved);
                log('‚úÖ √âtat charg√© depuis localStorage');
            } else {
                log('‚ÑπÔ∏è Nouveau joueur - √©tat initial');
            }
            checkNewDay();
        }

        function checkNewDay(){
            const today=getTodayLocal();
            if(gameState.lastGeneratedDate && gameState.lastGeneratedDate!==today){
                log(`üåÖ Nouveau jour d√©tect√©: ${today}`);
                const questsCompleted=Object.values(gameState.quests).filter(q=>q===true).length;
                const totalQuests=Object.keys(gameState.quests).length;
                const isPerfectDay=questsCompleted===totalQuests && totalQuests>0;
                
                if(questsCompleted>0){
                    gameState.history.push({
                        day:gameState.currentDay,
                        date:gameState.lastGeneratedDate,
                        questsCompleted,
                        totalQuests,
                        isPerfectDay,
                        level:gameState.level,
                        xp:gameState.xp,
                        attributes:{...gameState.attributes},
                        healthStatus:gameState.healthStatus?true:false
                    });
                    log(`üìä Historique ajout√©: ${questsCompleted}/${totalQuests} qu√™tes`);
                }
                
                if(isPerfectDay){
                    gameState.streak++;
                    log(`üî• S√©rie: ${gameState.streak} jours`);
                } else if(questsCompleted===0 && totalQuests>0){
                    gameState.streak=0;
                    log('üíî S√©rie perdue');
                }
                
                gameState.currentDay++;
                gameState.quests={};
                gameState.objectivesChecked={};
                gameState.dailyProgram=null;
                gameState.lastGeneratedDate=null;
                saveGameState();
            }
        }

        async function generateDailyProgram(){
            checkNewDay();
            
            log('üöÄ D√©but g√©n√©ration programme...');
            
            if(!gameState.apiKey){
                log('‚ùå Pas de cl√© API configur√©e', true);
                showSettings();
                return;
            }
            
            log('‚úÖ Cl√© API pr√©sente: ' + gameState.apiKey.substring(0, 10) + '...');
            
            const today=getTodayLocal();
            if(gameState.lastGeneratedDate===today){
                log('‚ö†Ô∏è Programme d√©j√† g√©n√©r√© aujourd\'hui', true);
                alert('Programme d√©j√† g√©n√©r√© aujourd\'hui ! Reviens demain pour de nouvelles qu√™tes.');
                return;
            }
            
            
            const btn=document.querySelector('.generate-daily-btn');
            btn.disabled=true;
            btn.classList.add('loading');
            
            try{
    log('üìù Cr√©ation du prompt...');
    
    const prompt = `Tu es le Syst√®me Solo Leveling. G√©n√®re un programme d'entra√Ænement quotidien ULTRA MOTIVANT pour le jour ${gameState.currentDay}/84.

CONTEXTE UTILISATEUR:
- Niveau: ${gameState.level} (${LEVELS[gameState.level-1].title})
- Attributs: Force ${gameState.attributes.force}, Intelligence ${gameState.attributes.intelligence}, Spirituel ${gameState.attributes.spirituel}, Discipline ${gameState.attributes.discipline}
- S√©rie: ${gameState.streak} jours parfaits
${gameState.healthStatus?`- ‚ö†Ô∏è SANT√â: ${gameState.healthStatus.type} - ${gameState.healthStatus.location} (gravit√© ${gameState.healthStatus.severity}/10). ${gameState.healthStatus.details||''}`:''}

PROFIL:
- Travail: Syndic, 70 emails/jour, 15 appels, 3 r√©unions/semaine (1h30 chacune), √©quipe de 4 personnes
- Horaires: D√©part 7h30, retour 17h (r√©cup√©ration fils cr√®che)
- Lieu: Halanzy, Belgique
- Physique: 1m75, 70kg
- Running: 5km en 27min (zone 3), 10km en 1h, utilise Polar Pacer Pro + app Runna
- Pr√©f√®re courir apr√®s travail ou midi (matin impr√©visible: r√©veil 6h30 ou 7h)
- Intol√©rant: fructose, sucrose, sorbitol
- Aliments OK: toutes viandes/poissons/c√©r√©ales/√©pices, citron uniquement pour fruits, l√©gumes: radis, c√©leri, asperges, haricots verts, pommes de terre, √©chalotes, ail, poireaux, champignons

R√àGLES STRICTES:
${gameState.healthStatus?`1. MODE R√âCUP√âRATION ACTIF - Adapter TOUS les exercices physiques`:''}
2. Horaires r√©alistes: Midi (12h-13h) OU Soir (17h30-19h) pour sport
3. Nutrition: AUCUN fructose/sucrose/sorbitol, uniquement aliments list√©s
4. 4 qu√™tes: Force (running/physique), Intelligence (travail/lecture), Spirituel (m√©ditation/nature), Discipline (routine)
5. Chaque qu√™te: 3 objectifs CONCRETS et MESURABLES
6. Ton ULTRA MOTIVANT style Solo Leveling

R√âPONDS UNIQUEMENT EN JSON (sans markdown):
{
  "advice": "Message motivant du Syst√®me (2-3 phrases)",
  "force": {
    "name": "Nom √©pique de la qu√™te",
    "objectives": [
      {"t": "Objectif 1"},
      {"t": "Objectif 2"},
      {"t": "Objectif 3"}
    ]
  },
  "intelligence": {
    "name": "Nom de qu√™te",
    "objectives": [{"t": "..."}, {"t": "..."}, {"t": "..."}]
  },
  "spirituel": {
    "name": "Nom de qu√™te",
    "objectives": [{"t": "..."}, {"t": "..."}, {"t": "..."}]
  },
  "discipline": {
    "name": "Nom de qu√™te",
    "objectives": [{"t": "..."}, {"t": "..."}, {"t": "..."}]
  }
}`;

    log('üåê Envoi requ√™te API Gemini...');

    const url = 'https://generativelanguage.googleapis.com/v1beta/gemini-2.0-flash:generateContent?key=' + gameState.apiKey;
    log('üìç URL API compl√®te: ' + url);

    const requestBody = {
        contents:[{parts:[{text:prompt}]}],
        generationConfig:{temperature:0.9,maxOutputTokens:2000}
    };

    log('üì¶ Taille prompt: ' + prompt.length + ' caract√®res');

    const response = await fetch(url, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(requestBody)
    });

    log('üì° R√©ponse re√ßue, status: ' + response.status);


                if(!response.ok) {
                    const errorText = await response.text();
                    log('‚ùå Erreur HTTP ' + response.status + ': ' + errorText.substring(0, 200), true);
                    throw new Error('Erreur API: ' + response.status);
                }

                const data = await response.json();
log('‚úÖ JSON re√ßu de l\'API');

if(!data.candidates || !data.candidates[0]) {
    log('‚ùå Format de r√©ponse invalide: ' + JSON.stringify(data).substring(0, 200), true);
    throw new Error('Format de r√©ponse API invalide');
}

let text = data.candidates[0].content.parts[0].text;
log('üìÑ Texte brut re√ßu: ' + text.substring(0, 100) + '...');

// NETTOYAGE AM√âLIOR√â DU TEXTE
text = text
    .replace(/```json\n?/g, '')
    .replace(/```\n?/g, '')
    .replace(/\n/g, ' ')
    .replace(/\r/g, '')
    .replace(/\t/g, ' ')
    .replace(/[\u0000-\u001F\u007F-\u009F]/g, '')
    .trim();

// Trouve le premier { et le dernier }
const firstBrace = text.indexOf('{');
const lastBrace = text.lastIndexOf('}');

if(firstBrace === -1 || lastBrace === -1) {
    log('‚ùå Pas de JSON valide trouv√© dans la r√©ponse', true);
    throw new Error('Format JSON introuvable dans la r√©ponse');
}

text = text.substring(firstBrace, lastBrace + 1);

log('üîß Texte nettoy√©: ' + text.substring(0, 150) + '...');
log('üì¶ Parsing JSON...');

let program;
try {
    program = JSON.parse(text);
} catch(parseError) {
    log('‚ùå Erreur de parsing: ' + parseError.message, true);
    log('üìÑ Texte probl√©matique: ' + text.substring(0, 300), true);
    throw new Error('Impossible de parser le JSON: ' + parseError.message);
}

log('‚úÖ Programme g√©n√©r√© avec succ√®s !');
log('üéØ Qu√™tes: ' + Object.keys(program).filter(k => k !== 'advice').length);

gameState.dailyProgram = program;
gameState.lastGeneratedDate = today;
gameState.lastAIAdvice = program.advice;
gameState.quests = {force:false,intelligence:false,spirituel:false,discipline:false};

saveGameState();
updateUI();

                
            }catch(error){
                log('‚ùå ERREUR FINALE: ' + error.message, true);
                if(error.stack) {
                    log('üìç Stack: ' + error.stack.substring(0, 300), true);
                }
                console.error(error);
                alert('Erreur lors de la g√©n√©ration. Regarde la console en bas pour plus de d√©tails.');
            }finally{
                btn.disabled = false;
                btn.classList.remove('loading');
                log('üèÅ Fin de la g√©n√©ration');
            }
        }
        function showSettings(){
            log('‚öôÔ∏è Ouverture des param√®tres');
            document.getElementById('apiKeyInput').value=gameState.apiKey||'';
            document.getElementById('apiStatus').style.display='none';
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettings(){
            log('‚öôÔ∏è Fermeture des param√®tres');
            document.getElementById('settingsModal').classList.remove('active');
        }

        function saveApiKey(){
            const key=document.getElementById('apiKeyInput').value.trim();
            if(!key){
                const status=document.getElementById('apiStatus');
                status.textContent='‚ùå La cl√© API ne peut pas √™tre vide';
                status.className='api-status error';
                status.style.display='block';
                log('‚ùå Tentative de sauvegarde cl√© vide', true);
                return;
            }
            
            gameState.apiKey=key;
            saveGameState();
            
            log('‚úÖ Cl√© API sauvegard√©e: ' + key.substring(0, 10) + '...');
            
            const status=document.getElementById('apiStatus');
            status.textContent='‚úÖ Cl√© API enregistr√©e avec succ√®s !';
            status.className='api-status success';
            status.style.display='block';
            
            setTimeout(()=>{
                closeSettings();
            },1500);
        }

        function showHealthReport(){
            log('üè• Ouverture rapport sant√©');
            document.getElementById('healthModal').classList.add('active');
        }

        function closeHealthReport(){
            log('üè• Fermeture rapport sant√©');
            document.getElementById('healthModal').classList.remove('active');
        }

        function submitHealthReport(){
            const type=document.getElementById('healthType').value;
            const location=document.getElementById('healthLocation').value.trim();
            const severity=parseInt(document.getElementById('healthSeverity').value);
            const details=document.getElementById('healthDetails').value.trim();
            
            if(!type||!location){
                alert('Merci de remplir au moins le type et la zone affect√©e.');
                log('‚ö†Ô∏è Formulaire sant√© incomplet', true);
                return;
            }
            
            gameState.healthStatus={type,location,severity,details};
            gameState.dailyProgram=null;
            gameState.lastGeneratedDate=null;
            
            log(`üè• Statut sant√© enregistr√©: ${type} - ${location} (${severity}/10)`);
            
            saveGameState();
            updateUI();
            closeHealthReport();
            
            alert('Programme adapt√© ! G√©n√®re un nouveau programme quotidien pour recevoir des exercices adapt√©s √† ta r√©cup√©ration.');
        }

        function clearHealthStatus(){
            gameState.healthStatus=null;
            gameState.dailyProgram=null;
            gameState.lastGeneratedDate=null;
            
            log('‚úÖ Statut sant√© effac√© - retour normal');
            
            saveGameState();
            updateUI();
            closeHealthReport();
            
            alert('F√©licitations pour ta gu√©rison ! Tu peux maintenant reprendre un programme normal.');
        }

        function updateUI(){
            log('üîÑ Mise √† jour de l\'interface');
            
            document.getElementById('level').textContent=gameState.level;
            document.getElementById('currentDay').textContent=gameState.currentDay;
            document.getElementById('currentXP').textContent=gameState.xp;
            document.getElementById('streak').textContent=gameState.streak;
            document.getElementById('tokens').textContent=gameState.tokens;
            document.getElementById('titleDisplay').textContent=LEVELS[gameState.level-1].title;
            
            const nextLevel=LEVELS[gameState.level];
            const maxXP=nextLevel?nextLevel.xp:9999;
            document.getElementById('maxXP').textContent=maxXP;
            
            const progress=nextLevel?((gameState.xp/maxXP)*100):100;
            document.getElementById('levelProgress').style.width=progress+'%';
            document.getElementById('levelProgressText').textContent=Math.floor(progress)+'%';
            
            ['force','intelligence','spirituel','discipline'].forEach(attr=>{
                const value=gameState.attributes[attr];
                document.getElementById(attr+'Value').textContent=value;
                const barProgress=Math.min((value/280)*100,100);
                document.getElementById(attr+'Bar').style.width=barProgress+'%';
            });
            
            if(gameState.healthStatus){
                const healthDiv=document.getElementById('healthStatus');
                const healthText=document.getElementById('healthStatusText');
                healthDiv.classList.add('active');
                healthText.innerHTML=`<strong>${gameState.healthStatus.location}</strong> (${gameState.healthStatus.type})<br>Gravit√©: ${gameState.healthStatus.severity}/10<br><em>Programme adapt√© pour favoriser ta r√©cup√©ration</em>`;
                log('‚ö†Ô∏è Mode r√©cup√©ration actif');
            }else{
                document.getElementById('healthStatus').classList.remove('active');
            }
            
            if(gameState.lastAIAdvice){
                const adviceDiv=document.getElementById('aiAdvice');
                adviceDiv.innerHTML=`
                    <div class="ai-advice">
                        <div class="ai-advice-title">‚ö° Message du Syst√®me</div>
                        <div>${gameState.lastAIAdvice}</div>
                    </div>
                `;
                adviceDiv.style.display='block';
            }else{
                document.getElementById('aiAdvice').style.display='none';
            }
            
            const questsContainer=document.getElementById('questsContainer');
            questsContainer.innerHTML='';
            
            if(gameState.dailyProgram){
                const questIcons={
                    force:'üí™',
                    intelligence:'üß†',
                    spirituel:'üßò',
                    discipline:'‚ö°'
                };
                
                Object.keys(gameState.dailyProgram).forEach(questType=>{
                    if(questType==='advice')return;
                    
                    const quest=gameState.dailyProgram[questType];
                    const isCompleted=gameState.quests[questType];
                    const isAdapted=gameState.healthStatus&&questType==='force';
                    
                    const questCard=document.createElement('div');
                    questCard.className=`quest-card${isCompleted?' completed':''}${isAdapted?' adapted':''}`;
                    questCard.id=`quest${questType.charAt(0).toUpperCase()+questType.slice(1)}`;
                    
                    let objectivesHTML='';
                    quest.objectives.forEach((obj,index)=>{
                        const isChecked=gameState.objectivesChecked[`${questType}_${index}`];
                        objectivesHTML+=`
                            <div class="objective${isChecked?' completed':''}" onclick="toggleObjective('${questType}',${index})">
                                <div class="checkbox${isChecked?' checked':''}"></div>
                                <span>${obj.t}</span>
                            </div>
                        `;
                    });
                    
                    questCard.innerHTML=`
                        <div class="quest-header">
                            <div class="quest-title">
                                <span class="quest-icon">${questIcons[questType]}</span>
                                <span>${quest.name}</span>
                            </div>
                            <div class="quest-reward">+2 PTS +10 XP</div>
                        </div>
                        <div class="quest-objectives">${objectivesHTML}</div>
                        <button class="complete-quest-btn${isCompleted?' completed':''}" 
                                onclick="completeQuest('${questType}')" 
                                ${isCompleted?'disabled':''}>
                            ${isCompleted?'‚úÖ Compl√©t√©':'‚úÖ Valider'}
                        </button>
                    `;
                    
                    questsContainer.appendChild(questCard);
                });
                
                log('‚úÖ ' + Object.keys(gameState.dailyProgram).filter(k=>k!=='advice').length + ' qu√™tes affich√©es');
            }
            
            const allCompleted=Object.keys(gameState.quests).length>0&&Object.values(gameState.quests).every(q=>q===true);
            document.getElementById('perfectDayBanner').style.display=allCompleted?'block':'none';
            
            updateTimeRemaining();
        }

        function toggleObjective(questType,index){
            checkNewDay();
            const key=`${questType}_${index}`;
            gameState.objectivesChecked[key]=!gameState.objectivesChecked[key];
            log(`‚úì Objectif ${key}: ${gameState.objectivesChecked[key]?'coch√©':'d√©coch√©'}`);
            saveGameState();
            updateUI();
        }

        function completeQuest(questType){
            checkNewDay();
            if(gameState.quests[questType]){
                alert('Cette qu√™te est d√©j√† compl√©t√©e aujourd\'hui !');
                log('‚ö†Ô∏è Tentative de compl√©ter une qu√™te d√©j√† faite', true);
                return;
            }
            
            gameState.quests[questType]=true;
            gameState.lastCompletedDate=getTodayLocal();
            gameState.attributes[questType]+=2;
            gameState.xp+=10;
            
            log(`üéâ Qu√™te ${questType} compl√©t√©e ! +2 ${questType}, +10 XP`);
            
            const allCompleted=Object.values(gameState.quests).every(q=>q===true);
            if(allCompleted){
                gameState.xp+=10;
                gameState.tokens+=1;
                log('üéä JOURN√âE PARFAITE ! +10 XP bonus, +1 jeton');
            }
            
            checkLevelUp();
            saveGameState();
            updateUI();
        }

        function checkLevelUp(){
            const nextLevel=LEVELS[gameState.level];
            if(nextLevel&&gameState.xp>=nextLevel.xp){
                gameState.level++;
                log(`üÜô LEVEL UP ! Niveau ${gameState.level}: ${LEVELS[gameState.level-1].title}`);
                showLevelUpModal();
            }
        }

        function showLevelUpModal(){
            const level=LEVELS[gameState.level-1];
            document.getElementById('levelUpText').innerHTML=`
                <p style="font-size: 60px; margin: 20px 0;">‚ö°</p>
                <p style="font-size: 28px; margin-bottom: 10px;">Niveau ${gameState.level}</p>
                <p style="font-size: 20px; color: #ffd700; margin-bottom: 20px;">${level.title}</p>
                <p style="font-size: 14px; color: #aaa;">${level.bonus}</p>
            `;
            document.getElementById('levelUpModal').classList.add('active');
        }

        function closeLevelUpModal(){
            document.getElementById('levelUpModal').classList.remove('active');
        }

        function showHistory(){
            checkNewDay();
            log('üìä Ouverture historique');
            const content=document.getElementById('historyContent');
            if(gameState.history.length===0){
                content.innerHTML='<p style="color: #aaa; padding: 20px;">Aucun historique pour le moment.<br>Compl√®te ta premi√®re journ√©e !</p>';
            }else{
                content.innerHTML=gameState.history.slice().reverse().map(day=>{
                    return `<div class="history-day">
                        <h3>Jour ${day.day} - ${new Date(day.date).toLocaleDateString('fr-FR')}</h3>
                        <div class="quest-summary">
                            ${day.questsCompleted}/${day.totalQuests} qu√™tes compl√©t√©es
                            ${day.isPerfectDay?'<br><strong style="color: #ffd700;">üéâ JOURN√âE PARFAITE</strong>':''}
                            ${day.healthStatus?'<br><span style="color: #ff6b35;">üè• Mode r√©cup√©ration</span>':''}
                        </div>
                        <div class="history-stats">
                            <div class="history-stat">
                                <div class="history-stat-value">${day.questsCompleted}/${day.totalQuests}</div>
                                <div class="history-stat-label">Qu√™tes</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-value">Niv. ${day.level}</div>
                                <div class="history-stat-label">Niveau</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-value">${day.xp}</div>
                                <div class="history-stat-label">XP Total</div>
                            </div>
                            <div class="history-stat">
                                <div class="history-stat-value">${day.attributes.force}</div>
                                <div class="history-stat-label">Force</div>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            }
            document.getElementById('historyModal').classList.add('active');
        }

        function closeHistory(){
            log('üìä Fermeture historique');
            document.getElementById('historyModal').classList.remove('active');
        }

        function updateTimeRemaining(){
            const now=new Date();
            const tomorrow=new Date(now);
            tomorrow.setDate(tomorrow.getDate()+1);
            tomorrow.setHours(0,0,0,0);
            const diff=tomorrow-now;
            const hours=Math.floor(diff/(1000*60*60));
            const minutes=Math.floor((diff%(1000*60*60))/(1000*60));
            document.getElementById('timeRemaining').textContent=`‚è∞ ${hours}h ${minutes}min avant minuit`;
        }

        window.addEventListener('DOMContentLoaded',()=>{
            log('üöÄ Application d√©marr√©e');
            loadGameState();
            updateUI();
            setInterval(updateTimeRemaining,60000);
            log('‚úÖ Interface initialis√©e');
        });
    </script>
</body>
</html>

